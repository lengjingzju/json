# LJSON 说明

[English Edition](./README.md)

[LJSON：全能、高性能、真流式的 C 语言 JSON 引擎和数值引擎](./notes/introduction_zh-cn.md)

[LJSON 高性能优化的平衡之道：哲学思维与工程实践](./notes/optimization_zh-cn.md)

[yyjson ≠ 万能王者：它只是 LJSON DOM 复用模式的一个特化版本](./notes/cmp_yyjson_zh-cn.md)

[一种有限定义域内快速整除的实现方法](./notes/fastdiv_zh-cn.md)

## 概述

LJSON 是一款面向极致性能设计的双模数据处理引擎，既是符合JSON5标准的全能JSON处理器，也是业界领先的数值字符串双向转换工具库。

* 双重核心能力：
    * JSON全能处理：完整支持JSON5规范，提供DOM/SAX双解析模式，文件流式处理能力
    * 数值转换引擎：独创ldouble算法实现浮点字符串互转，性能碾压传统方案

> 注：64位操作系统上，从v5.0.0版本开始，对象字节由40字节降低到32字节，解析速度提升5%~10%，和v3.x.x版本不兼容。

## 主要特性

### LJSON特性

* 极速JSON处理：远超cJSON，大幅领先RapidJSON，小幅领先yyjson的解析/打印性能
* 先进浮点转换：内置ldouble算法，比标准库快10~70倍，比行业方案快10%~100%
* 完整JSON5支持：十六进制、注释、尾逗号等现代JSON特性（部分特性需要启用json.c中的特定宏）
* 多场景优化：DOM/SAX双模式、内存池、内存复用、文件流处理等高效内存管理
    * LJSON文件流解析时是边读取边解析，打印时是边打印边写入，而不是yyjson读完再解析，打印完再写入的伪流模式
    * 内存复用指：1.原始数据直接作为键和字符串的存储点；2. 多次解析和打印时一直复用同一块内存，库内部都无需进行堆内存分配
    * SAX和文件流配合使用可将内存占用变为常数级，即使1GB的JSON文件也可以仅用KB级的内存转换为格式化的JSON文件
* 多数据类型支持：支持长整型、十六进制数字等扩展类型
* 开发者友好：参考cJSON的接口设计，纯C实现，无第三方库依赖，支持多种编译器和处理器架构

### LDOUBLE算法特性

* 字符串转数值算法比标准库快1~10倍
* 浮点数转字符串LDOUBLE算法为追求性能不完全符合IEEE-754标准，拥有17位精度，且始终输出最短精确表示
    * LDOUBLE算法的耗时仅为sprintf的1.5%-10%（即快10-70倍）
    * LDOUBLE算法除一位小数外一般显著快于grisu2算法，特别是科学计数法表示时，可快100%以上
    * LDOUBLE算法绝大多数情况下快于dragonbox算法 ，特别是科学计数法表示时，可快30%以上

## 编译运行

### 编译方法

* 直接编译

```sh
gcc -o ljson json.c jnum.c json_test.c -O2 -ffunction-sections -fdata-sections -W -Wall
```

* [IMAKE](https://github.com/lengjingzju/cbuild-ng) 编译

```sh
make O=<编译输出目录> && make O=<编译输出目录> DESTDIR=<安装目录>
```

* 交叉编译

```sh
make O=<编译输出目录> CROSS_COMPILE=<交叉编译器前缀> && make O=<编译输出目录> DESTDIR=<安装目录>
```

* 选择浮点数转字符串算法 `gcc -DJSON_DTOA_ALGORITHM=n` 或 `make DTOA=n`， n可能为 0 / 1 / 2 / 3
    * 0: 个人实现的 ldouble 算法
    * 1: C标准库的 sprintf
    * 2: 个人优化的 grisu2 算法
    * 3: 个人优化的 dragonbox 算法
<br>

* 选择大查找表或小查找表 `gcc -DUSING_SMALL_LUT=n` 或 `make SMALL=n`， n可能为 0 / 1
    * 0: 大查找表，速度可能更快一些
    * 1: 小查找表，使用小查找表代码段小约5KB
<br>

* Windows MSC
    * 使用 `Visual Studio 2022` 打开 `MSC\ljson\ljson.sln`

### 运行方法

```sh
./ljson <json文件名> <测试序号0-7>
```

### 调试方法

* 设置 json.c 中的变量 `JSON_ERROR_PRINT_ENABLE` 的值为 `1` 后重新编译

### 解析配置

* `#define JSON_PARSE_SKIP_COMMENT         1` : 是否允许类似C语言的单行注释和多行注释(JSON5特性)
* `#define JSON_PARSE_LAST_COMMA           1` : 是否允许JSON_ARRAY或JSON_OBJECT的最后一个元素的末尾有逗号(JSON5特性)
* `#define JSON_PARSE_EMPTY_KEY            0` : 是否允许键为空字符串
* `#define JSON_PARSE_SPECIAL_CHAR         1` : 是否允许字符串中有特殊的字符，例如换行符(JSON5特性)
* `#define JSON_PARSE_SPECIAL_QUOTES       1` : 是否允许字符串值可以使用单引号，键值可以使用单引号或无引号(JSON5特性)
* `#define JSON_PARSE_HEX_NUM              1` : 是否允许十六进制的解析(JSON5特性)
* `#define JSON_PARSE_SPECIAL_NUM          1` : 是否允许特殊的数字，例如前导0，加号，无整数的浮点数等，例如 `+99` `.1234` `10.` `001` 等(JSON5特性)
* `#define JSON_PARSE_SPECIAL_DOUBLE       1` : 是否允许特殊的double值 `NaN` `Infinity` `-Infinity`(JSON5特性)
* `#define JSON_PARSE_SINGLE_VALUE         1` : 是否允许不是JSON_ARRAY或JSON_OBJECT开头的JSON值
* `#define JSON_PARSE_FINISHED_CHAR        0` : 是否解析完成后忽略检查字符串尾部的合法性

注：

* 如果需要100%符合 [nativejson-benchmark](https://github.com/miloyip/nativejson-benchmark)，需要将 `JSON_PARSE_EMPTY_KEY` 置为1，其它值全部置为0。
* `JSON_PARSE_SKIP_COMMENT` 和 `JSON_PARSE_SPECIAL_QUOTES` 置为1时会显著影响解析速度。

## 性能测试

### 测试代码

其它json的测试代码位于benchmark目录，将对应的文件放在对应json工程的根目录即可

```sh
gcc -o cjson cjson_test.c cJSON.c -O2               # cJSON
g++ -o rapidjson rapidjson_test.c -Iinclude -O2     # RapidJSON
gcc -o yyjson yyjson_test.c src/yyjson.c -Isrc -O2  # yyjson
gcc -o strdup strdup_test.c -O2                     # strdup和strlen
```

测试脚本

```sh
#!/bin/bash

src=$1

if [ -z $src ] || [ ! -e $src ]; then
	echo "Usage: $0 <json file>"
	exit 1
fi

run_cmd() {
	printf "%-15s " $1
	eval $@
	sync
	sleep 0.1
}

for i in `seq 1 7`; do
	run_cmd ./ljson $src $i
done

run_cmd ./cjson $src
run_cmd ./rapidjson $src
run_cmd ./yyjson $src
run_cmd ./yyjson $src 1
run_cmd ./strdup $src
```

测试模式

* ljson提供7种测试模式
    * 1: 普通DOM模式，使用malloc申请内存，解析和打印都为字符串
    * 2: 快速DOM模式，申请大内存，然后内存从大内存分配(无法单独释放小内存)，解析和打印都为字符串
    * 3: 重用DOM模式，申请大内存，然后内存从大内存分配(无法单独释放小内存)，且键和字符串值重用原始解析字符串，解析和打印都为字符串
    * 4: 文件DOM模式，无需读完文件再解析或打印完再写入，使用malloc申请内存，边读文件边解析，边打印边写入文件
    * 5: 快速文件DOM模式，无需读完文件再解析或打印完再写入，申请大内存，然后内存从大内存分配(无法单独释放小内存)，边读文件边解析，边打印边写入文件
    * 6: 普通SAX模式，解析和打印都为字符串
    * 7: 文件SAX模式，无需读完文件再解析，边读文件边解析
* yyjson提供两种测试模式：unmutable 和 mutable 模式

### JSON测试结果

注1：主要是测试速度，`O2` 优化等级且默认选项编译，测试文件来自 [nativejson-benchmark](https://github.com/miloyip/nativejson-benchmark) 项目

注2：由于功能增加、逻辑优化等修改，最新版本不一定符合下面测试结果，例如使用了更精确的数字处理，浮点数解析性能会下降(处理canada.json)，优化复用模式(模式3)分支预测，解析性能会上升。

> 测试平台: ARM64开发板 | CPU: ARM CortexA53 | OS: Linux-5.15<br>
> 测试结果: LJSON 比cJSON 解析最快可达 475%，打印最快可达 2836%，LJSON 比 RapidJSON 解析最快可达 131%，打印最快可达 147% (耗时含文件读写时间)

![AARCH64-Linux测试结果](image/test_for_aarch64.png)

> 测试平台: PC | CPU: Intel i7-10700 | OS: Ubuntu 18.04 (VirtualBox)<br>
> 测试结果: LJSON 比cJSON 解析最快可达 560%，打印最快可达 3184%，LJSON 比 RapidJSON 解析最快可达 75%，打印最快可达 133% (耗时含文件读写时间)

![x86_64-Linux测试结果](image/test_for_x86_64.png)

> 测试平台: PC | CPU: Intel i7-1260P | OS: Ubuntu 20.04 (VMWare)<br>
> 测试结果: LJSON 比cJSON 解析最快可达 510%，打印最快可达 2273%，LJSON 比 RapidJSON 解析最快可达 76%，打印最快可达 144% (耗时不含文件读写时间)

### 浮点数转字符串算法测试结果

**测试方法**

```sh
make O=obj
./benchmark/benchmark.sh obj
```
> 测试平台: PC | CPU: Intel i7-1260P | OS: Ubuntu 20.04 (VMWare)<br>
> 测试命令: `./jnum_test <num> 10000000` # 测试千万次
> 测试结果: ldouble比sprintf快一个数量级(某些用例可快40倍)，也比grisu2和dragonbox快一些；ldouble在精度范围内可以保证最短，和printf输出一致

注：三个值分别是输出字符串、千万次运行耗时、对比sprintf的速度提升百分比。

| Input | sprintf | ldouble | grisu2 | dragonbox |
| :---- | :------ | :------ | :----- | :-------- |
| `0.1` | `0.1` `1448ms` | `0.1` `85ms` `1704%` | `0.1` `82ms` `1766%` | `0.1` `92ms` `1574%` |
| `0.2` | `0.2` `1407ms` | `0.2` `83ms` `1695%` | `0.2` `83ms` `1695%` | `0.2` `98ms` `1436%` |
| `0.3` | `0.3` `1484ms` | `0.3` `79ms` `1878%` | `0.3` `86ms` `1726%` | `0.3` `106ms` `1400%` |
| `0.4` | `0.4` `1413ms` | `0.4` `77ms` `1835%` | `0.4` `83ms` `1702%` | `0.4` `93ms` `1519%` |
| `0.5` | `0.5` `1426ms` | `0.5` `74ms` `1927%` | `0.5` `81ms` `1760%` | `0.5` `95ms` `1501%` |
| `0.6` | `0.6` `1493ms` | `0.6` `76ms` `1964%` | `0.6` `97ms` `1539%` | `0.6` `89ms` `1678%` |
| `0.7` | `0.7` `1485ms` | `0.7` `79ms` `1880%` | `0.7` `80ms` `1856%` | `0.7` `94ms` `1580%` |
| `0.8` | `0.8` `1375ms` | `0.8` `81ms` `1698%` | `0.8` `84ms` `1637%` | `0.8` `91ms` `1511%` |
| `0.9` | `0.9` `1433ms` | `0.9` `83ms` `1727%` | `0.9` `90ms` `1592%` | `0.9` `97ms` `1477%` |

| Input | sprintf | ldouble | grisu2 | dragonbox |
| :---- | :------ | :------ | :----- | :-------- |
| `0.11` | `0.11` `1511ms` | `0.11` `87ms` `1737%` | `0.11` `94ms` `1607%` | `0.11` `97ms` `1558%` |
| `0.101` | `0.101` `1522ms` | `0.101` `85ms` `1791%` | `0.101` `116ms` `1312%` | `0.101` `114ms` `1335%` |
| `0.1001` | `0.1001` `1555ms` | `0.1001` `93ms` `1672%` | `0.1001` `130ms` `1196%` | `0.1001` `109ms` `1427%` |
| `0.10001` | `0.10001` `1554ms` | `0.10001` `93ms` `1671%` | `0.10001` `119ms` `1306%` | `0.10001` `106ms` `1466%` |
| `0.100001` | `0.100001` `1558ms` | `0.100001` `93ms` `1675%` | `0.100001` `129ms` `1208%` | `0.100001` `107ms` `1456%` |
| `0.1000001` | `0.1000001` `1554ms` | `0.1000001` `88ms` `1766%` | `0.1000001` `136ms` `1143%` | `0.1000001` `111ms` `1400%` |
| `0.10000001` | `0.10000001` `1508ms` | `0.10000001` `97ms` `1555%` | `0.10000001` `142ms` `1062%` | `0.10000001` `110ms` `1371%` |
| `0.100000001` | `0.100000001` `1560ms` | `0.100000001` `103ms` `1515%` | `0.100000001` `148ms` `1054%` | `0.100000001` `113ms` `1381%` |
| `0.1000000001` | `0.1000000001` `1650ms` | `0.1000000001` `99ms` `1667%` | `0.1000000001` `154ms` `1071%` | `0.1000000001` `114ms` `1447%` |
| `0.10000000001` | `0.10000000001` `1570ms` | `0.10000000001` `97ms` `1619%` | `0.10000000001` `173ms` `908%` | `0.10000000001` `117ms` `1342%` |
| `0.100000000001` | `0.100000000001` `1645ms` | `0.100000000001` `93ms` `1769%` | `0.100000000001` `182ms` `904%` | `0.100000000001` `123ms` `1337%` |
| `0.1000000000001` | `0.1000000000001` `1596ms` | `0.1000000000001` `95ms` `1680%` | `0.1000000000001` `186ms` `858%` | `0.1000000000001` `107ms` `1492%` |
| `0.10000000000001` | `0.10000000000001` `1574ms` | `0.10000000000001` `92ms` `1711%` | `0.10000000000001` `194ms` `811%` | `0.10000000000001` `109ms` `1444%` |
| `0.100000000000001` | `0.100000000000001` `1521ms` | `0.100000000000001` `99ms` `1536%` | `0.100000000000001` `197ms` `772%` | `0.100000000000001` `108ms` `1408%` |
| `0.1000000000000001` | `0.1000000000000001` `1542ms` | `0.1000000000000001` `89ms` `1733%` | `0.1000000000000001` `213ms` `724%` | `0.1000000000000001` `107ms` `1441%` |

| Input | sprintf | ldouble | grisu2 | dragonbox |
| :---- | :------ | :------ | :----- | :-------- |
| `1.1` | `1.1` `1167ms` | `1.1` `76ms` `1536%` | `1.1` `92ms` `1268%` | `1.1` `100ms` `1167%` |
| `2.2` | `2.2` `1151ms` | `2.2` `74ms` `1555%` | `2.2` `96ms` `1199%` | `2.2` `104ms` `1107%` |
| `3.3` | `3.3` `1239ms` | `3.3` `79ms` `1568%` | `3.3` `100ms` `1239%` | `3.3` `100ms` `1239%` |
| `4.4` | `4.4` `1191ms` | `4.4` `81ms` `1470%` | `4.4` `94ms` `1267%` | `4.4` `99ms` `1203%` |
| `5.5` | `5.5` `1239ms` | `5.5` `84ms` `1475%` | `5.5` `108ms` `1147%` | `5.5` `97ms` `1277%` |
| `6.6` | `6.6` `1268ms` | `6.6` `77ms` `1647%` | `6.6` `97ms` `1307%` | `6.6` `95ms` `1335%` |
| `7.7` | `7.7` `1176ms` | `7.7` `81ms` `1452%` | `7.7` `101ms` `1164%` | `7.7` `99ms` `1188%` |
| `8.8` | `8.800000000000001` `1379ms` | `8.8` `80ms` `1724%` | `8.8` `91ms` `1515%` | `8.8` `100ms` `1379%` |
| `9.9` | `9.9` `1331ms` | `9.9` `81ms` `1643%` | `9.9` `98ms` `1358%` | `9.9` `100ms` `1331%` |

| Input | sprintf | ldouble | grisu2 | dragonbox |
| :---- | :------ | :------ | :----- | :-------- |
| `0.1` | `0.1` `1488ms` | `0.1` `87ms` `1710%` | `0.1` `85ms` `1751%` | `0.1` `100ms` `1488%` |
| `0.12` | `0.12` `1598ms` | `0.12` `86ms` `1858%` | `0.12` `99ms` `1614%` | `0.12` `103ms` `1551%` |
| `0.123` | `0.123` `1590ms` | `0.123` `93ms` `1710%` | `0.123` `119ms` `1336%` | `0.123` `103ms` `1544%` |
| `0.1234` | `0.1234` `1595ms` | `0.1234` `94ms` `1697%` | `0.1234` `133ms` `1199%` | `0.1234` `106ms` `1505%` |
| `0.12345` | `0.12345` `1584ms` | `0.12345` `101ms` `1568%` | `0.12345` `119ms` `1331%` | `0.12345` `115ms` `1377%` |
| `0.123456` | `0.123456` `1674ms` | `0.123456` `98ms` `1708%` | `0.123456` `138ms` `1213%` | `0.123456` `116ms` `1443%` |
| `0.1234567` | `0.1234567` `1588ms` | `0.1234567` `99ms` `1604%` | `0.1234567` `140ms` `1134%` | `0.1234567` `114ms` `1393%` |
| `0.12345678` | `0.12345678` `1534ms` | `0.12345678` `103ms` `1489%` | `0.12345678` `148ms` `1036%` | `0.12345678` `122ms` `1257%` |
| `0.123456789` | `0.123456789` `1630ms` | `0.123456789` `104ms` `1567%` | `0.123456789` `163ms` `1000%` | `0.123456789` `125ms` `1304%` |
| `0.12345678901` | `0.12345678901` `1607ms` | `0.12345678901` `112ms` `1435%` | `0.12345678901` `184ms` `873%` | `0.12345678901` `127ms` `1265%` |
| `0.123456789012` | `0.123456789012` `1578ms` | `0.123456789012` `109ms` `1448%` | `0.123456789012` `179ms` `882%` | `0.123456789012` `128ms` `1233%` |
| `0.1234567890123` | `0.1234567890123` `1599ms` | `0.1234567890123` `112ms` `1428%` | `0.1234567890123` `184ms` `869%` | `0.1234567890123` `129ms` `1240%` |
| `0.12345678901234` | `0.12345678901234` `1579ms` | `0.12345678901234` `108ms` `1462%` | `0.12345678901234` `201ms` `786%` | `0.12345678901234` `138ms` `1144%` |
| `0.123456789012345` | `0.123456789012345` `1569ms` | `0.123456789012345` `108ms` `1453%` | `0.123456789012345` `207ms` `758%` | `0.123456789012345` `134ms` `1171%` |
| `0.1234567890123456` | `0.1234567890123456` `1553ms` | `0.1234567890123456` `115ms` `1350%` | `0.1234567890123456` `208ms` `747%` | `0.1234567890123456` `135ms` `1150%` |

| Input | sprintf | ldouble | grisu2 | dragonbox |
| :---- | :------ | :------ | :----- | :-------- |
| `0.1e100` | `1e+99` `3644ms` | `1e+99` `66ms` `5521%` | `1e+99` `74ms` `4924%` | `1e+99` `85ms` `4287%` |
| `0.12e100` | `1.2e+99` `2880ms` | `1.2e+99` `81ms` `3556%` | `1.2e+99` `105ms` `2743%` | `1.2e+99` `108ms` `2667%` |
| `0.123e100` | `1.23e+99` `3670ms` | `1.23e+99` `76ms` `4829%` | `1.23e+99` `116ms` `3164%` | `1.23e+99` `107ms` `3430%` |
| `0.1234e100` | `1.234e+99` `3664ms` | `1.234e+99` `81ms` `4523%` | `1.234e+99` `131ms` `2797%` | `1.234e+99` `113ms` `3242%` |
| `0.12345e100` | `1.2345e+99` `3684ms` | `1.2345e+99` `85ms` `4334%` | `1.2345e+99` `137ms` `2689%` | `1.2345e+99` `115ms` `3203%` |
| `0.123456e100` | `1.23456e+99` `3136ms` | `1.23456e+99` `89ms` `3524%` | `1.23456e+99` `167ms` `1878%` | `1.23456e+99` `117ms` `2680%` |
| `0.1234567e100` | `1.234567e+99` `3212ms` | `1.234567e+99` `89ms` `3609%` | `1.234567e+99` `184ms` `1746%` | `1.234567e+99` `124ms` `2590%` |
| `0.12345678e100` | `1.2345678e+99` `3639ms` | `1.2345678e+99` `93ms` `3913%` | `1.2345678e+99` `190ms` `1915%` | `1.2345678e+99` `129ms` `2821%` |
| `0.123456789e100` | `1.23456789e+99` `3478ms` | `1.23456789e+99` `100ms` `3478%` | `1.23456789e+99` `183ms` `1901%` | `1.23456789e+99` `128ms` `2717%` |
| `0.12345678901e100` | `1.2345678901e+99` `3698ms` | `1.2345678901e+99` `87ms` `4251%` | `1.2345678901e+99` `203ms` `1822%` | `1.2345678901e+99` `129ms` `2867%` |
| `0.123456789012e100` | `1.23456789012e+99` `3704ms` | `1.23456789012e+99` `99ms` `3741%` | `1.23456789012e+99` `212ms` `1747%` | `1.23456789012e+99` `123ms` `3011%` |
| `0.1234567890123e100` | `1.234567890123e+99` `3814ms` | `1.234567890123e+99` `105ms` `3632%` | `1.234567890123e+99` `233ms` `1637%` | `1.234567890123e+99` `141ms` `2705%` |
| `0.12345678901234e100` | `1.2345678901234e+99` `4019ms` | `1.2345678901234e+99` `101ms` `3979%` | `1.2345678901234e+99` `221ms` `1819%` | `1.2345678901234e+99` `150ms` `2679%` |
| `0.123456789012345e100` | `1.23456789012345e+99` `4031ms` | `1.23456789012345e+99` `108ms` `3732%` | `1.23456789012345e+99` `227ms` `1776%` | `1.23456789012345e+99` `136ms` `2964%` |
| `0.1234567890123456e100` | `1.234567890123456e+99` `3627ms` | `1.234567890123456e+99` `103ms` `3521%` | `1.234567890123456e+99` `223ms` `1626%` | `1.234567890123456e+99` `137ms` `2647%` |

| Input | sprintf | ldouble | grisu2 | dragonbox |
| :---- | :------ | :------ | :----- | :-------- |
| `0.1e-100` | `1e-101` `2125ms` | `1e-101` `71ms` `2993%` | `1e-101` `83ms` `2560%` | `1e-101` `88ms` `2415%` |
| `0.12e-100` | `1.2e-101` `2170ms` | `1.2e-101` `77ms` `2818%` | `1.2e-101` `104ms` `2087%` | `1.2e-101` `102ms` `2127%` |
| `0.123e-100` | `1.23e-101` `2125ms` | `1.23e-101` `80ms` `2656%` | `1.23e-101` `122ms` `1742%` | `1.23e-101` `110ms` `1932%` |
| `0.1234e-100` | `1.234e-101` `2185ms` | `1.234e-101` `85ms` `2571%` | `1.234e-101` `144ms` `1517%` | `1.234e-101` `109ms` `2005%` |
| `0.12345e-100` | `1.2345e-101` `2150ms` | `1.2345e-101` `87ms` `2471%` | `1.2345e-101` `149ms` `1443%` | `1.2345e-101` `118ms` `1822%` |
| `0.123456e-100` | `1.23456e-101` `2163ms` | `1.23456e-101` `83ms` `2606%` | `1.23456e-101` `166ms` `1303%` | `1.23456e-101` `116ms` `1865%` |
| `0.1234567e-100` | `1.234567e-101` `2218ms` | `1.234567e-101` `85ms` `2609%` | `1.234567e-101` `200ms` `1109%` | `1.234567e-101` `118ms` `1880%` |
| `0.12345678e-100` | `1.2345678e-101` `2195ms` | `1.2345678e-101` `96ms` `2286%` | `1.2345678e-101` `200ms` `1098%` | `1.2345678e-101` `119ms` `1845%` |
| `0.123456789e-100` | `1.23456789e-101` `2201ms` | `1.23456789e-101` `98ms` `2246%` | `1.23456789e-101` `196ms` `1123%` | `1.23456789e-101` `130ms` `1693%` |
| `0.12345678901e-100` | `1.2345678901e-101` `2231ms` | `1.2345678901e-101` `96ms` `2324%` | `1.2345678901e-101` `219ms` `1019%` | `1.2345678901e-101` `132ms` `1690%` |
| `0.123456789012e-100` | `1.23456789012e-101` `2219ms` | `1.23456789012e-101` `106ms` `2093%` | `1.23456789012e-101` `211ms` `1052%` | `1.23456789012e-101` `130ms` `1707%` |
| `0.1234567890123e-100` | `1.234567890123e-101` `2196ms` | `1.234567890123e-101` `106ms` `2072%` | `1.234567890123e-101` `221ms` `994%` | `1.234567890123e-101` `146ms` `1504%` |
| `0.12345678901234e-100` | `1.2345678901234e-101` `2205ms` | `1.2345678901234e-101` `102ms` `2162%` | `1.2345678901234e-101` `235ms` `938%` | `1.2345678901234e-101` `134ms` `1646%` |
| `0.123456789012345e-100` | `1.23456789012345e-101` `2204ms` | `1.23456789012345e-101` `101ms` `2182%` | `1.23456789012345e-101` `232ms` `950%` | `1.23456789012345e-101` `137ms` `1609%` |
| `0.1234567890123456e-100` | `1.234567890123456e-101` `2159ms` | `1.234567890123456e-101` `112ms` `1928%` | `1.234567890123456e-101` `257ms` `840%` | `1.234567890123456e-101` `162ms` `1333%` |

| Input | sprintf | ldouble | grisu2 | dragonbox |
| :---- | :------ | :------ | :----- | :-------- |
| `1e1` | `10` `966ms` | `10.0` `32ms` `3019%` | `10.0` `83ms` `1164%` | `10.0` `36ms` `2683%` |
| `1e2` | `100` `1094ms` | `100.0` `36ms` `3039%` | `100.0` `75ms` `1459%` | `100.0` `40ms` `2735%` |
| `1e3` | `1000` `1310ms` | `1000.0` `37ms` `3541%` | `1000.0` `78ms` `1679%` | `1000.0` `42ms` `3119%` |
| `1e4` | `10000` `1350ms` | `10000.0` `35ms` `3857%` | `10000.0` `84ms` `1607%` | `10000.0` `37ms` `3649%` |
| `1e5` | `100000` `1466ms` | `100000.0` `32ms` `4581%` | `100000.0` `81ms` `1810%` | `100000.0` `35ms` `4189%` |
| `1e6` | `1000000` `1484ms` | `1000000.0` `40ms` `3710%` | `1000000.0` `76ms` `1953%` | `1000000.0` `41ms` `3620%` |
| `1e7` | `10000000` `1471ms` | `10000000.0` `43ms` `3421%` | `10000000.0` `81ms` `1816%` | `10000000.0` `42ms` `3502%` |
| `1e8` | `100000000` `1525ms` | `100000000.0` `37ms` `4122%` | `100000000.0` `240ms` `635%` | `100000000.0` `38ms` `4013%` |
| `1e9` | `1000000000` `1597ms` | `1000000000.0` `38ms` `4203%` | `1000000000.0` `234ms` `682%` | `1000000000.0` `42ms` `3802%` |
| `1e10` | `10000000000` `1679ms` | `10000000000.0` `43ms` `3905%` | `10000000000.0` `252ms` `666%` | `10000000000.0` `44ms` `3816%` |
| `1e11` | `100000000000` `1843ms` | `100000000000.0` `40ms` `4608%` | `100000000000.0` `250ms` `737%` | `100000000000.0` `52ms` `3544%` |
| `1e12` | `1000000000000` `1778ms` | `1000000000000.0` `39ms` `4559%` | `1000000000000.0` `273ms` `651%` | `1000000000000.0` `45ms` `3951%` |
| `1e13` | `10000000000000` `1907ms` | `10000000000000.0` `42ms` `4540%` | `10000000000000.0` `269ms` `709%` | `10000000000000.0` `45ms` `4238%` |
| `1e14` | `100000000000000` `1962ms` | `100000000000000.0` `43ms` `4563%` | `100000000000000.0` `233ms` `842%` | `100000000000000.0` `45ms` `4360%` |
| `1e15` | `1000000000000000` `2038ms` | `1000000000000000.0` `44ms` `4632%` | `1000000000000000.0` `165ms` `1235%` | `1000000000000000.0` `50ms` `4076%` |
| `1e16` | `1e+16` `1162ms` | `10000000000000000.0` `33ms` `3521%` | `10000000000000000.0` `164ms` `709%` | `10000000000000000.0` `95ms` `1223%` |

| Input | sprintf | ldouble | grisu2 | dragonbox |
| :---- | :------ | :------ | :----- | :-------- |
| `1e-1` | `0.1` `1540ms` | `0.1` `83ms` `1855%` | `0.1` `85ms` `1812%` | `0.1` `100ms` `1540%` |
| `1e-2` | `0.01` `1511ms` | `0.01` `83ms` `1820%` | `0.01` `88ms` `1717%` | `0.01` `100ms` `1511%` |
| `1e-3` | `0.001` `1719ms` | `0.001` `75ms` `2292%` | `0.001` `98ms` `1754%` | `0.001` `100ms` `1719%` |
| `1e-4` | `0.0001` `1595ms` | `0.0001` `82ms` `1945%` | `0.0001` `110ms` `1450%` | `0.0001` `103ms` `1549%` |
| `1e-5` | `1e-05` `1518ms` | `0.00001` `75ms` `2024%` | `0.00001` `106ms` `1432%` | `0.00001` `103ms` `1474%` |
| `1e-6` | `1e-06` `1737ms` | `0.000001` `84ms` `2068%` | `0.000001` `104ms` `1670%` | `0.000001` `101ms` `1720%` |
| `1e-7` | `1e-07` `1583ms` | `0.0000001` `97ms` `1632%` | `1e-7` `77ms` `2056%` | `0.0000001` `105ms` `1508%` |
| `1e-8` | `1e-08` `1525ms` | `1e-8` `69ms` `2210%` | `1e-8` `75ms` `2033%` | `1e-8` `86ms` `1773%` |
| `1e-9` | `1e-09` `1623ms` | `1e-9` `62ms` `2618%` | `1e-9` `69ms` `2352%` | `1e-9` `85ms` `1909%` |
| `1e-10` | `1e-10` `1590ms` | `1e-10` `65ms` `2446%` | `1e-10` `79ms` `2013%` | `1e-10` `86ms` `1849%` |
| `1e-11` | `9.999999999999999e-12` `1627ms` | `1e-11` `70ms` `2324%` | `1e-11` `88ms` `1849%` | `1e-11` `89ms` `1828%` |
| `1e-12` | `1e-12` `1720ms` | `1e-12` `68ms` `2529%` | `1e-12` `94ms` `1830%` | `1e-12` `86ms` `2000%` |
| `1e-13` | `1e-13` `1663ms` | `1e-13` `71ms` `2342%` | `1e-13` `80ms` `2079%` | `1e-13` `88ms` `1890%` |
| `1e-14` | `1e-14` `1761ms` | `1e-14` `71ms` `2480%` | `1e-14` `76ms` `2317%` | `1e-14` `88ms` `2001%` |
| `1e-15` | `1e-15` `1799ms` | `1e-15` `71ms` `2534%` | `1e-15` `81ms` `2221%` | `1e-15` `98ms` `1836%` |
| `1e-16` | `1e-16` `1649ms` | `1e-16` `64ms` `2577%` | `1e-16` `82ms` `2011%` | `1e-16` `94ms` `1754%` |

| Input | sprintf | ldouble | grisu2 | dragonbox |
| :---- | :------ | :------ | :----- | :-------- |
| `0.9` | `0.9` `1412ms` | `0.9` `73ms` `1934%` | `0.9` `84ms` `1681%` | `0.9` `94ms` `1502%` |
| `0.99` | `0.99` `1534ms` | `0.99` `75ms` `2045%` | `0.99` `93ms` `1649%` | `0.99` `102ms` `1504%` |
| `0.999` | `0.999` `1498ms` | `0.999` `87ms` `1722%` | `0.999` `121ms` `1238%` | `0.999` `109ms` `1374%` |
| `0.9999` | `0.9999` `1483ms` | `0.9999` `88ms` `1685%` | `0.9999` `127ms` `1168%` | `0.9999` `113ms` `1312%` |
| `0.99999` | `0.99999` `1462ms` | `0.99999` `89ms` `1643%` | `0.99999` `122ms` `1198%` | `0.99999` `107ms` `1366%` |
| `0.999999` | `0.999999` `1552ms` | `0.999999` `100ms` `1552%` | `0.999999` `142ms` `1093%` | `0.999999` `113ms` `1373%` |
| `0.9999999` | `0.9999999000000001` `1513ms` | `0.9999999` `104ms` `1455%` | `0.9999999` `138ms` `1096%` | `0.9999999` `112ms` `1351%` |
| `0.99999999` | `0.9999999899999999` `1470ms` | `0.99999999` `103ms` `1427%` | `0.99999999` `144ms` `1021%` | `0.99999999` `120ms` `1225%` |
| `0.999999999` | `0.999999999` `1442ms` | `0.999999999` `101ms` `1428%` | `0.999999999` `145ms` `994%` | `0.999999999` `124ms` `1163%` |
| `0.9999999999` | `0.9999999999` `1464ms` | `0.9999999999` `103ms` `1421%` | `0.9999999999` `149ms` `983%` | `0.9999999999` `115ms` `1273%` |
| `0.99999999999` | `0.99999999999` `1463ms` | `0.99999999999` `108ms` `1355%` | `0.99999999999` `179ms` `817%` | `0.99999999999` `126ms` `1161%` |
| `0.999999999999` | `0.999999999999` `1489ms` | `0.999999999999` `106ms` `1405%` | `0.999999999999` `178ms` `837%` | `0.999999999999` `129ms` `1154%` |
| `0.9999999999999` | `0.9999999999999` `1534ms` | `0.9999999999999` `104ms` `1475%` | `0.9999999999999` `184ms` `834%` | `0.9999999999999` `129ms` `1189%` |
| `0.99999999999999` | `0.99999999999999` `1498ms` | `0.99999999999999` `106ms` `1413%` | `0.99999999999999` `193ms` `776%` | `0.99999999999999` `135ms` `1110%` |
| `0.999999999999999` | `0.999999999999999` `1484ms` | `0.999999999999999` `110ms` `1349%` | `0.999999999999999` `209ms` `710%` | `0.999999999999999` `141ms` `1052%` |
| `0.9999999999999999` | `0.9999999999999999` `1513ms` | `0.9999999999999999` `112ms` `1351%` | `0.9999999999999999` `211ms` `717%` | `0.9999999999999999` `142ms` `1065%` |

| Input | sprintf | ldouble | grisu2 | dragonbox |
| :---- | :------ | :------ | :----- | :-------- |
| `9.9` | `9.9` `1316ms` | `9.9` `92ms` `1430%` | `9.9` `105ms` `1253%` | `9.9` `101ms` `1303%` |
| `9.99` | `9.99` `1338ms` | `9.99` `80ms` `1672%` | `9.99` `125ms` `1070%` | `9.99` `96ms` `1394%` |
| `9.999` | `9.999000000000001` `1426ms` | `9.999` `76ms` `1876%` | `9.999` `129ms` `1105%` | `9.999` `106ms` `1345%` |
| `9.9999` | `9.9999` `1368ms` | `9.9999` `80ms` `1710%` | `9.9999` `146ms` `937%` | `9.9999` `117ms` `1169%` |
| `9.99999` | `9.99999` `1378ms` | `9.99999` `101ms` `1364%` | `9.99999` `142ms` `970%` | `9.99999` `109ms` `1264%` |
| `9.999999` | `9.999999000000001` `1399ms` | `9.999999` `93ms` `1504%` | `9.999999` `156ms` `897%` | `9.999999` `122ms` `1147%` |
| `9.9999999` | `9.999999900000001` `1387ms` | `9.9999999` `95ms` `1460%` | `9.9999999` `155ms` `895%` | `9.9999999` `122ms` `1137%` |
| `9.99999999` | `9.999999989999999` `1375ms` | `9.99999999` `93ms` `1478%` | `9.99999999` `163ms` `844%` | `9.99999999` `121ms` `1136%` |
| `9.999999999` | `9.999999999` `1490ms` | `9.999999999` `99ms` `1505%` | `9.999999999` `166ms` `898%` | `9.999999999` `121ms` `1231%` |
| `9.9999999999` | `9.9999999999` `1420ms` | `9.9999999999` `105ms` `1352%` | `9.9999999999` `171ms` `830%` | `9.9999999999` `129ms` `1101%` |
| `9.99999999999` | `9.999999999990001` `1345ms` | `9.99999999999` `95ms` `1416%` | `9.999999999990001` `203ms` `663%` | `9.99999999999` `127ms` `1059%` |
| `9.999999999999` | `9.999999999999` `1402ms` | `9.999999999999` `101ms` `1388%` | `9.999999999999` `188ms` `746%` | `9.999999999999` `132ms` `1062%` |
| `9.9999999999999` | `9.999999999999901` `1457ms` | `9.9999999999999` `113ms` `1289%` | `9.9999999999999` `190ms` `767%` | `9.9999999999999` `128ms` `1138%` |
| `9.99999999999999` | `9.999999999999989` `1416ms` | `9.99999999999999` `109ms` `1299%` | `9.99999999999999` `203ms` `698%` | `9.99999999999999` `132ms` `1073%` |
| `9.999999999999999` | `9.999999999999998` `1387ms` | `9.999999999999999` `113ms` `1227%` | `9.999999999999999` `209ms` `664%` | `9.999999999999998` `143ms` `970%` |
| `9.9999999999999999` | `10` `926ms` | `10.0` `28ms` `3307%` | `10.0` `74ms` `1251%` | `10.0` `33ms` `2806%` |

| Input | sprintf | ldouble | grisu2 | dragonbox |
| :---- | :------ | :------ | :----- | :-------- |
| `0.1` | `0.1` `1502ms` | `0.1` `85ms` `1767%` | `0.1` `85ms` `1767%` | `0.1` `99ms` `1517%` |
| `0.11` | `0.11` `1530ms` | `0.11` `96ms` `1594%` | `0.11` `102ms` `1500%` | `0.11` `99ms` `1545%` |
| `0.111` | `0.111` `1537ms` | `0.111` `98ms` `1568%` | `0.111` `119ms` `1292%` | `0.111` `107ms` `1436%` |
| `0.1111` | `0.1111` `1546ms` | `0.1111` `98ms` `1578%` | `0.1111` `132ms` `1171%` | `0.1111` `102ms` `1516%` |
| `0.11111` | `0.11111` `1545ms` | `0.11111` `93ms` `1661%` | `0.11111` `120ms` `1288%` | `0.11111` `120ms` `1288%` |
| `0.111111` | `0.111111` `1539ms` | `0.111111` `94ms` `1637%` | `0.111111` `139ms` `1107%` | `0.111111` `113ms` `1362%` |
| `0.1111111` | `0.1111111` `1556ms` | `0.1111111` `98ms` `1588%` | `0.1111111` `137ms` `1136%` | `0.1111111` `115ms` `1353%` |
| `0.11111111` | `0.11111111` `1580ms` | `0.11111111` `103ms` `1534%` | `0.11111111` `140ms` `1129%` | `0.11111111` `119ms` `1328%` |
| `0.111111111` | `0.111111111` `1608ms` | `0.111111111` `102ms` `1576%` | `0.111111111` `152ms` `1058%` | `0.111111111` `122ms` `1318%` |
| `0.1111111111` | `0.1111111111` `1549ms` | `0.1111111111` `107ms` `1448%` | `0.1111111111` `168ms` `922%` | `0.1111111111` `129ms` `1201%` |
| `0.11111111111` | `0.11111111111` `1584ms` | `0.11111111111` `101ms` `1568%` | `0.11111111111` `172ms` `921%` | `0.11111111111` `129ms` `1228%` |
| `0.111111111111` | `0.111111111111` `1617ms` | `0.111111111111` `110ms` `1470%` | `0.111111111111` `179ms` `903%` | `0.111111111111` `125ms` `1294%` |
| `0.1111111111111` | `0.1111111111111` `1589ms` | `0.1111111111111` `107ms` `1485%` | `0.1111111111111` `192ms` `828%` | `0.1111111111111` `140ms` `1135%` |
| `0.11111111111111` | `0.11111111111111` `1581ms` | `0.11111111111111` `113ms` `1399%` | `0.11111111111111` `195ms` `811%` | `0.11111111111111` `142ms` `1113%` |
| `0.111111111111111` | `0.111111111111111` `1552ms` | `0.111111111111111` `111ms` `1398%` | `0.111111111111111` `201ms` `772%` | `0.111111111111111` `131ms` `1185%` |
| `0.1111111111111111` | `0.1111111111111111` `1606ms` | `0.1111111111111111` `115ms` `1397%` | `0.1111111111111111` `212ms` `758%` | `0.1111111111111111` `139ms` `1155%` |

| Input | sprintf | ldouble | grisu2 | dragonbox |
| :---- | :------ | :------ | :----- | :-------- |
| `1.1` | `1.1` `1249ms` | `1.1` `78ms` `1601%` | `1.1` `101ms` `1237%` | `1.1` `100ms` `1249%` |
| `1.11` | `1.11` `1258ms` | `1.11` `79ms` `1592%` | `1.11` `124ms` `1015%` | `1.11` `103ms` `1221%` |
| `1.111` | `1.111` `1279ms` | `1.111` `96ms` `1332%` | `1.111` `138ms` `927%` | `1.111` `113ms` `1132%` |
| `1.1111` | `1.1111` `1310ms` | `1.1111` `88ms` `1489%` | `1.1111` `149ms` `879%` | `1.1111` `111ms` `1180%` |
| `1.11111` | `1.11111` `1260ms` | `1.11111` `94ms` `1340%` | `1.11111` `136ms` `926%` | `1.11111` `109ms` `1156%` |
| `1.111111` | `1.111111` `1303ms` | `1.111111` `84ms` `1551%` | `1.111111` `148ms` `880%` | `1.111111` `112ms` `1163%` |
| `1.1111111` | `1.1111111` `1264ms` | `1.1111111` `100ms` `1264%` | `1.1111111` `160ms` `790%` | `1.1111111` `118ms` `1071%` |
| `1.11111111` | `1.11111111` `1266ms` | `1.11111111` `98ms` `1292%` | `1.11111111` `176ms` `719%` | `1.11111111` `132ms` `959%` |
| `1.111111111` | `1.111111111` `1228ms` | `1.111111111` `95ms` `1293%` | `1.111111111` `163ms` `753%` | `1.111111111` `122ms` `1007%` |
| `1.1111111111` | `1.1111111111` `1289ms` | `1.1111111111` `98ms` `1315%` | `1.1111111111` `167ms` `772%` | `1.1111111111` `121ms` `1065%` |
| `1.11111111111` | `1.11111111111` `1267ms` | `1.11111111111` `104ms` `1218%` | `1.11111111111` `181ms` `700%` | `1.11111111111` `121ms` `1047%` |
| `1.111111111111` | `1.111111111111` `1265ms` | `1.111111111111` `102ms` `1240%` | `1.111111111111` `190ms` `666%` | `1.111111111111` `142ms` `891%` |
| `1.1111111111111` | `1.1111111111111` `1239ms` | `1.1111111111111` `101ms` `1227%` | `1.1111111111111` `195ms` `635%` | `1.1111111111111` `138ms` `898%` |
| `1.11111111111111` | `1.11111111111111` `1279ms` | `1.11111111111111` `103ms` `1242%` | `1.11111111111111` `195ms` `656%` | `1.11111111111111` `132ms` `969%` |
| `1.111111111111111` | `1.111111111111111` `1212ms` | `1.111111111111111` `114ms` `1063%` | `1.111111111111111` `209ms` `580%` | `1.111111111111111` `132ms` `918%` |
| `1.1111111111111111` | `1.111111111111111` `1246ms` | `1.1111111111111112` `111ms` `1123%` | `1.1111111111111112` `214ms` `582%` | `1.1111111111111112` `142ms` `877%` |

| Input | sprintf | ldouble | grisu2 | dragonbox |
| :---- | :------ | :------ | :----- | :-------- |
| `1e-300` | `1e-300` `2626ms` | `1e-300` `70ms` `3751%` | `1e-300` `89ms` `2951%` | `1e-300` `89ms` `2951%` |
| `1e-301` | `1e-301` `2815ms` | `1e-301` `74ms` `3804%` | `1e-301` `79ms` `3563%` | `1e-301` `91ms` `3093%` |
| `1e-302` | `1e-302` `2945ms` | `1e-302` `71ms` `4148%` | `1e-302` `79ms` `3728%` | `1e-302` `87ms` `3385%` |
| `1e-303` | `9.999999999999999e-304` `2423ms` | `1e-303` `76ms` `3188%` | `1e-303` `88ms` `2753%` | `1e-303` `89ms` `2722%` |
| `1e-304` | `1e-304` `2589ms` | `1e-304` `66ms` `3923%` | `1e-304` `80ms` `3236%` | `1e-304` `93ms` `2784%` |
| `1e-305` | `1e-305` `2758ms` | `1e-305` `71ms` `3885%` | `1e-305` `82ms` `3363%` | `1e-305` `90ms` `3064%` |
| `1e-306` | `1e-306` `2615ms` | `1e-306` `68ms` `3846%` | `1e-306` `82ms` `3189%` | `1e-306` `87ms` `3006%` |
| `1e-307` | `9.999999999999999e-308` `2706ms` | `1e-307` `72ms` `3758%` | `1e-307` `95ms` `2848%` | `1e-307` `101ms` `2679%` |
| `1e-308` | `9.999999999999999e-309` `2765ms` | `1e-308` `70ms` `3950%` | `1e-308` `132ms` `2095%` | `1e-308` `72ms` `3840%` |
| `1e-309` | `1.000000000000002e-309` `2858ms` | `1e-309` `70ms` `4083%` | `1e-309` `106ms` `2696%` | `1e-309` `62ms` `4610%` |
| `1e-310` | `9.999999999999969e-311` `2855ms` | `1e-310` `59ms` `4839%` | `1e-310` `103ms` `2772%` | `1e-310` `62ms` `4605%` |
| `1e-311` | `9.999999999999475e-312` `2633ms` | `1e-311` `62ms` `4247%` | `1e-311` `106ms` `2484%` | `1e-311` `56ms` `4702%` |
| `1e-312` | `9.999999999984653e-313` `2722ms` | `1e-312` `66ms` `4124%` | `1e-312` `111ms` `2452%` | `1e-312` `64ms` `4253%` |
| `1e-313` | `1.000000000013287e-313` `2824ms` | `1e-313` `60ms` `4707%` | `1e-313` `103ms` `2742%` | `1e-313` `64ms` `4412%` |
| `1e-314` | `9.999999999638807e-315` `2880ms` | `1e-314` `57ms` `5053%` | `1e-314` `118ms` `2441%` | `1e-314` `61ms` `4721%` |
| `1e-315` | `9.999999984816838e-316` `2799ms` | `1e-315` `50ms` `5598%` | `1e-315` `140ms` `1999%` | `1e-315` `59ms` `4744%` |
| `1e-316` | `9.999999836597144e-317` `2940ms` | `1e-316` `57ms` `5158%` | `1e-316` `137ms` `2146%` | `1e-316` `63ms` `4667%` |
| `1e-317` | `1.000000230692537e-317` `3075ms` | `1e-317` `54ms` `5694%` | `1e-317` `101ms` `3045%` | `1e-317` `53ms` `5802%` |
| `1e-318` | `9.999987484955998e-319` `3100ms` | `1e-318` `56ms` `5536%` | `1e-318` `106ms` `2925%` | `1e-318` `56ms` `5536%` |
| `1e-319` | `9.99988867182683e-320` `2410ms` | `1e-319` `55ms` `4382%` | `1e-319` `108ms` `2231%` | `1e-319` `52ms` `4635%` |
| `1e-320` | `9.99988867182683e-321` `2525ms` | `1e-320` `56ms` `4509%` | `1e-320` `103ms` `2451%` | `1e-320` `59ms` `4280%` |
| `1e-321` | `9.98012604599318e-322` `2622ms` | `1e-321` `49ms` `5351%` | `1e-321` `106ms` `2474%` | `1e-321` `53ms` `4947%` |
| `1e-322` | `9.881312916824931e-323` `2707ms` | `1e-322` `53ms` `5108%` | `1e-322` `105ms` `2578%` | `1e-322` `58ms` `4667%` |
| `1e-323` | `9.881312916824931e-324` `2604ms` | `1e-323` `51ms` `5106%` | `1e-323` `136ms` `1915%` | `1e-323` `50ms` `5208%` |

| Input | sprintf | ldouble | grisu2 | dragonbox |
| :---- | :------ | :------ | :----- | :-------- |
| `1e+300` | `1e+300` `3586ms` | `1e+300` `70ms` `5123%` | `1e+300` `88ms` `4075%` | `1e+300` `89ms` `4029%` |
| `1e+301` | `1e+301` `3832ms` | `1e+301` `75ms` `5109%` | `1e+301` `97ms` `3951%` | `1e+301` `89ms` `4306%` |
| `1e+302` | `1e+302` `3822ms` | `1e+302` `67ms` `5704%` | `1e+302` `79ms` `4838%` | `1e+302` `87ms` `4393%` |
| `1e+303` | `1e+303` `3933ms` | `1e+303` `67ms` `5870%` | `1e+303` `83ms` `4739%` | `1e+303` `94ms` `4184%` |
| `1e+304` | `9.999999999999999e+303` `5572ms` | `1e+304` `73ms` `7633%` | `1e+304` `82ms` `6795%` | `1e+304` `86ms` `6479%` |
| `1e+305` | `9.999999999999999e+304` `5476ms` | `1e+305` `74ms` `7400%` | `1e+305` `81ms` `6760%` | `1e+305` `89ms` `6153%` |
| `1e+306` | `1e+306` `3772ms` | `1e+306` `75ms` `5029%` | `1e+306` `78ms` `4836%` | `1e+306` `89ms` `4238%` |
| `1e+307` | `1e+307` `5700ms` | `1e+307` `78ms` `7308%` | `1e+307` `78ms` `7308%` | `1e+307` `88ms` `6477%` |
| `1e+308` | `1e+308` `3777ms` | `1e+308` `66ms` `5723%` | `1e+308` `88ms` `4292%` | `1e+308` `86ms` `4392%` |
| `1e+309` | `inf` `320ms` | `inf` `19ms` `1684%` | `1.797693134862316e+308` `254ms` `126%` | `inf` `18ms` `1778%` |
| `1e+310` | `inf` `352ms` | `inf` `18ms` `1956%` | `1.797693134862316e+308` `245ms` `144%` | `inf` `17ms` `2071%` |

| Input | sprintf | ldouble | grisu2 | dragonbox |
| :---- | :------ | :------ | :----- | :-------- |
| `9.999999999999999` | `9.999999999999998` `1393ms` | `9.999999999999999` `117ms` `1191%` | `9.999999999999999` `212ms` `657%` | `9.999999999999998` `148ms` `941%` |
| `9.999999999999991` | `9.999999999999991` `1366ms` | `9.999999999999992` `114ms` `1198%` | `9.999999999999992` `206ms` `663%` | `9.999999999999991` `141ms` `969%` |
| `9.999999999999989` | `9.999999999999989` `1351ms` | `9.99999999999999` `106ms` `1275%` | `9.99999999999999` `197ms` `686%` | `9.99999999999999` `133ms` `1016%` |
| `9.999999999999981` | `9.99999999999998` `1356ms` | `9.99999999999998` `117ms` `1159%` | `9.99999999999998` `196ms` `692%` | `9.99999999999998` `136ms` `997%` |
| `9.999999999999979` | `9.999999999999979` `1368ms` | `9.999999999999979` `118ms` `1159%` | `9.999999999999979` `217ms` `630%` | `9.999999999999979` `151ms` `906%` |
| `9.999999999999971` | `9.999999999999972` `1374ms` | `9.999999999999972` `124ms` `1108%` | `9.999999999999972` `206ms` `667%` | `9.999999999999972` `138ms` `996%` |
| `9.999999999999969` | `9.99999999999997` `1442ms` | `9.99999999999997` `108ms` `1335%` | `9.99999999999997` `207ms` `697%` | `9.99999999999997` `126ms` `1144%` |
| `9.999999999999961` | `9.999999999999961` `1431ms` | `9.999999999999961` `116ms` `1234%` | `9.999999999999961` `220ms` `650%` | `9.999999999999961` `144ms` `994%` |
| `9.999999999999959` | `9.999999999999959` `1413ms` | `9.99999999999996` `111ms` `1273%` | `9.99999999999996` `201ms` `703%` | `9.99999999999996` `131ms` `1079%` |
| `9.999999999999951` | `9.99999999999995` `1400ms` | `9.99999999999995` `113ms` `1239%` | `9.99999999999995` `206ms` `680%` | `9.99999999999995` `140ms` `1000%` |
| `9.999999999999949` | `9.999999999999948` `1399ms` | `9.999999999999949` `120ms` `1166%` | `9.999999999999949` `217ms` `645%` | `9.999999999999948` `150ms` `933%` |
| `9.999999999999941` | `9.999999999999941` `1512ms` | `9.999999999999942` `145ms` `1043%` | `9.999999999999942` `231ms` `655%` | `9.999999999999941` `155ms` `975%` |
| `9.999999999999939` | `9.99999999999994` `1435ms` | `9.99999999999994` `105ms` `1367%` | `9.99999999999994` `209ms` `687%` | `9.99999999999994` `141ms` `1018%` |
| `9.999999999999931` | `9.999999999999931` `1397ms` | `9.99999999999993` `107ms` `1306%` | `9.99999999999993` `207ms` `675%` | `9.99999999999993` `135ms` `1035%` |
| `9.999999999999929` | `9.999999999999929` `1460ms` | `9.999999999999929` `126ms` `1159%` | `9.999999999999929` `222ms` `658%` | `9.999999999999929` `149ms` `980%` |
| `9.999999999999921` | `9.999999999999922` `1474ms` | `9.999999999999922` `125ms` `1179%` | `9.999999999999922` `229ms` `644%` | `9.999999999999922` `151ms` `976%` |
| `9.999999999999919` | `9.999999999999918` `1523ms` | `9.999999999999919` `132ms` `1154%` | `9.999999999999919` `226ms` `674%` | `9.999999999999918` `139ms` `1096%` |
| `9.999999999999911` | `9.999999999999911` `1476ms` | `9.999999999999912` `124ms` `1190%` | `9.999999999999912` `217ms` `680%` | `9.999999999999911` `144ms` `1025%` |
| `9.999999999999909` | `9.999999999999909` `1514ms` | `9.99999999999991` `129ms` `1174%` | `9.99999999999991` `230ms` `658%` | `9.99999999999991` `131ms` `1156%` |
| `9.999999999999901` | `9.999999999999901` `1507ms` | `9.9999999999999` `122ms` `1235%` | `9.9999999999999` `219ms` `688%` | `9.9999999999999` `137ms` `1100%` |


### 字符串转浮点数算法测试结果

**测试方法**

```sh
make O=obj
./benchmark/benchmark.sh obj atod
```
> 测试平台: PC | CPU: Intel i7-1260P | OS: Ubuntu 20.04 (VMWare)<br>
> 测试命令: `./jnum_test <num> 10000000` # 测试千万次
> 测试结果: ldouble比atod大多数情况下快2~3倍(某些用例可快10倍)

注：三个值分别是输出字符串、千万次运行耗时、对比atod的速度提升百分比。

| Input | atod    | ldouble |
| :---- | :------ | :------ |
| `0.1` | ` 0.1 224ms` | `0.1 45ms` `498%` |
| `0.2` | ` 0.2 223ms` | `0.2 45ms` `496%` |
| `0.3` | ` 0.3 226ms` | `0.3 47ms` `481%` |
| `0.4` | ` 0.4 228ms` | `0.4 45ms` `507%` |
| `0.5` | ` 0.5 218ms` | `0.5 47ms` `464%` |
| `0.6` | ` 0.6 222ms` | `0.6 46ms` `483%` |
| `0.7` | ` 0.7 224ms` | `0.7 45ms` `498%` |
| `0.8` | ` 0.8 236ms` | `0.8 46ms` `513%` |
| `0.9` | ` 0.9 241ms` | `0.9 47ms` `513%` |

| Input | atod    | ldouble |
| :---- | :------ | :------ |
| `0.11` | ` 0.11 252ms` | `0.11 49ms` `514%` |
| `0.101` | ` 0.101 338ms` | `0.101 57ms` `593%` |
| `0.1001` | ` 0.1001 301ms` | `0.1001 72ms` `418%` |
| `0.10001` | ` 0.10001 362ms` | `0.10001 63ms` `575%` |
| `0.100001` | ` 0.100001 372ms` | `0.100001 76ms` `489%` |
| `0.1000001` | ` 0.1000001 352ms` | `0.1000001 75ms` `469%` |
| `0.10000001` | ` 0.10000001 348ms` | `0.10000001 82ms` `424%` |
| `0.100000001` | ` 0.100000001 435ms` | `0.100000001 83ms` `524%` |
| `0.1000000001` | ` 0.1000000001 410ms` | `0.1000000001 90ms` `456%` |
| `0.10000000001` | ` 0.10000000001 409ms` | `0.10000000001 94ms` `435%` |
| `0.100000000001` | ` 0.100000000001 435ms` | `0.100000000001 96ms` `453%` |
| `0.1000000000001` | ` 0.1000000000001 421ms` | `0.1000000000001 103ms` `409%` |
| `0.10000000000001` | ` 0.10000000000001 449ms` | `0.10000000000001 108ms` `416%` |
| `0.100000000000001` | ` 0.100000000000001 512ms` | `0.100000000000001 113ms` `453%` |
| `0.1000000000000001` | ` 0.1000000000000001 439ms` | `0.1000000000000001 117ms` `375%` |

| Input | atod    | ldouble |
| :---- | :------ | :------ |
| `1.1` | ` 1.1 308ms` | `1.1 48ms` `642%` |
| `2.2` | ` 2.2 294ms` | `2.2 46ms` `639%` |
| `3.3` | ` 3.3 305ms` | `3.3 46ms` `663%` |
| `4.4` | ` 4.4 285ms` | `4.4 46ms` `620%` |
| `5.5` | ` 5.5 280ms` | `5.5 48ms` `583%` |
| `6.6` | ` 6.6 290ms` | `6.6 46ms` `630%` |
| `7.7` | ` 7.7 288ms` | `7.7 47ms` `613%` |
| `8.8` | ` 8.8 284ms` | `8.8 46ms` `617%` |
| `9.9` | ` 9.9 294ms` | `9.9 46ms` `639%` |

| Input | atod    | ldouble |
| :---- | :------ | :------ |
| `0.1` | ` 0.1 235ms` | `0.1 46ms` `511%` |
| `0.12` | ` 0.12 259ms` | `0.12 47ms` `551%` |
| `0.123` | ` 0.123 333ms` | `0.123 53ms` `628%` |
| `0.1234` | ` 0.1234 297ms` | `0.1234 69ms` `430%` |
| `0.12345` | ` 0.12345 341ms` | `0.12345 72ms` `474%` |
| `0.123456` | ` 0.123456 358ms` | `0.123456 79ms` `453%` |
| `0.1234567` | ` 0.1234567 387ms` | `0.1234567 81ms` `478%` |
| `0.12345678` | ` 0.12345678 366ms` | `0.12345678 88ms` `416%` |
| `0.123456789` | ` 0.123456789 389ms` | `0.123456789 85ms` `458%` |
| `0.12345678901` | ` 0.12345678901 409ms` | `0.12345678901 97ms` `422%` |
| `0.123456789012` | ` 0.123456789012 433ms` | `0.123456789012 102ms` `425%` |
| `0.1234567890123` | ` 0.1234567890123 460ms` | `0.1234567890123 105ms` `438%` |
| `0.12345678901234` | ` 0.12345678901234 454ms` | `0.12345678901234 108ms` `420%` |
| `0.123456789012345` | ` 0.123456789012345 514ms` | `0.123456789012345 119ms` `432%` |
| `0.1234567890123456` | ` 0.1234567890123456 445ms` | `0.1234567890123456 120ms` `371%` |

| Input | atod    | ldouble |
| :---- | :------ | :------ |
| `0.1e100` | ` 1e+99 431ms` | `1e+99 74ms` `582%` |
| `0.12e100` | ` 1.2e+99 427ms` | `1.2e+99 75ms` `569%` |
| `0.123e100` | ` 1.23e+99 454ms` | `1.23e+99 83ms` `547%` |
| `0.1234e100` | ` 1.234e+99 441ms` | `1.234e+99 82ms` `538%` |
| `0.12345e100` | ` 1.2345e+99 584ms` | `1.2345e+99 90ms` `649%` |
| `0.123456e100` | ` 1.23456e+99 532ms` | `1.23456e+99 92ms` `578%` |
| `0.1234567e100` | ` 1.234567e+99 550ms` | `1.234567e+99 99ms` `556%` |
| `0.12345678e100` | ` 1.2345678e+99 536ms` | `1.2345678e+99 102ms` `525%` |
| `0.123456789e100` | ` 1.23456789e+99 539ms` | `1.23456789e+99 103ms` `523%` |
| `0.12345678901e100` | ` 1.2345678901e+99 560ms` | `1.2345678901e+99 111ms` `505%` |
| `0.123456789012e100` | ` 1.23456789012e+99 535ms` | `1.23456789012e+99 117ms` `457%` |
| `0.1234567890123e100` | ` 1.234567890123e+99 602ms` | `1.234567890123e+99 123ms` `489%` |
| `0.12345678901234e100` | ` 1.2345678901234e+99 580ms` | `1.2345678901234e+99 131ms` `443%` |
| `0.123456789012345e100` | ` 1.23456789012345e+99 569ms` | `1.23456789012345e+99 141ms` `404%` |
| `0.1234567890123456e100` | ` 1.234567890123456e+99 563ms` | `1.234567890123456e+99 142ms` `396%` |

| Input | atod    | ldouble |
| :---- | :------ | :------ |
| `0.1e-100` | ` 1e-101 682ms` | `1e-101 83ms` `822%` |
| `0.12e-100` | ` 1.2e-101 699ms` | `1.2e-101 79ms` `885%` |
| `0.123e-100` | ` 1.23e-101 748ms` | `1.23e-101 85ms` `880%` |
| `0.1234e-100` | ` 1.234e-101 687ms` | `1.234e-101 91ms` `755%` |
| `0.12345e-100` | ` 1.2345e-101 775ms` | `1.2345e-101 88ms` `881%` |
| `0.123456e-100` | ` 1.23456e-101 759ms` | `1.23456e-101 96ms` `791%` |
| `0.1234567e-100` | ` 1.234567e-101 794ms` | `1.234567e-101 103ms` `771%` |
| `0.12345678e-100` | ` 1.2345678e-101 813ms` | `1.2345678e-101 101ms` `805%` |
| `0.123456789e-100` | ` 1.23456789e-101 817ms` | `1.23456789e-101 107ms` `764%` |
| `0.12345678901e-100` | ` 1.2345678901e-101 908ms` | `1.2345678901e-101 117ms` `776%` |
| `0.123456789012e-100` | ` 1.23456789012e-101 788ms` | `1.23456789012e-101 126ms` `625%` |
| `0.1234567890123e-100` | ` 1.234567890123e-101 853ms` | `1.234567890123e-101 124ms` `688%` |
| `0.12345678901234e-100` | ` 1.2345678901234e-101 883ms` | `1.2345678901234e-101 137ms` `645%` |
| `0.123456789012345e-100` | ` 1.23456789012345e-101 841ms` | `1.23456789012345e-101 137ms` `614%` |
| `0.1234567890123456e-100` | ` 1.234567890123456e-101 906ms` | `1.234567890123456e-101 146ms` `621%` |

| Input | atod    | ldouble |
| :---- | :------ | :------ |
| `1e1` | ` 10.0 194ms` | `10.0 46ms` `422%` |
| `1e2` | ` 100.0 195ms` | `100.0 47ms` `415%` |
| `1e3` | ` 1000.0 194ms` | `1000.0 45ms` `431%` |
| `1e4` | ` 10000.0 196ms` | `10000.0 47ms` `417%` |
| `1e5` | ` 100000.0 194ms` | `100000.0 45ms` `431%` |
| `1e6` | ` 1000000.0 212ms` | `1000000.0 44ms` `482%` |
| `1e7` | ` 10000000.0 192ms` | `10000000.0 44ms` `436%` |
| `1e8` | ` 100000000.0 192ms` | `100000000.0 43ms` `447%` |
| `1e9` | ` 1000000000.0 183ms` | `1000000000.0 45ms` `407%` |
| `1e10` | ` 10000000000.0 210ms` | `10000000000.0 46ms` `457%` |
| `1e11` | ` 100000000000.0 210ms` | `100000000000.0 48ms` `438%` |
| `1e12` | ` 1000000000000.0 211ms` | `1000000000000.0 48ms` `440%` |
| `1e13` | ` 10000000000000.0 201ms` | `10000000000000.0 50ms` `402%` |
| `1e14` | ` 100000000000000.0 211ms` | `100000000000000.0 48ms` `440%` |
| `1e15` | ` 1000000000000000.0 207ms` | `1000000000000000.0 47ms` `440%` |
| `1e16` | ` 10000000000000000.0 203ms` | `10000000000000000.0 46ms` `441%` |

| Input | atod    | ldouble |
| :---- | :------ | :------ |
| `1e-1` | ` 0.1 250ms` | `0.1 45ms` `556%` |
| `1e-2` | ` 0.01 254ms` | `0.01 46ms` `552%` |
| `1e-3` | ` 0.001 316ms` | `0.001 46ms` `687%` |
| `1e-4` | ` 0.0001 272ms` | `0.0001 47ms` `579%` |
| `1e-5` | ` 0.00001 337ms` | `0.00001 46ms` `733%` |
| `1e-6` | ` 0.000001 335ms` | `0.000001 48ms` `698%` |
| `1e-7` | ` 0.0000001 341ms` | `0.0000001 49ms` `696%` |
| `1e-8` | ` 1e-8 296ms` | `1e-8 48ms` `617%` |
| `1e-9` | ` 1e-9 341ms` | `1e-9 45ms` `758%` |
| `1e-10` | ` 1e-10 366ms` | `1e-10 48ms` `762%` |
| `1e-11` | ` 1e-11 349ms` | `1e-11 49ms` `712%` |
| `1e-12` | ` 1e-12 361ms` | `1e-12 51ms` `708%` |
| `1e-13` | ` 1e-13 356ms` | `1e-13 49ms` `727%` |
| `1e-14` | ` 1e-14 354ms` | `1e-14 49ms` `722%` |
| `1e-15` | ` 1e-15 403ms` | `1e-15 49ms` `822%` |
| `1e-16` | ` 1e-16 308ms` | `1e-16 50ms` `616%` |

| Input | atod    | ldouble |
| :---- | :------ | :------ |
| `0.9` | ` 0.9 241ms` | `0.9 46ms` `524%` |
| `0.99` | ` 0.99 260ms` | `0.99 49ms` `531%` |
| `0.999` | ` 0.999 344ms` | `0.999 59ms` `583%` |
| `0.9999` | ` 0.9999 318ms` | `0.9999 70ms` `454%` |
| `0.99999` | ` 0.99999 371ms` | `0.99999 72ms` `515%` |
| `0.999999` | ` 0.999999 374ms` | `0.999999 73ms` `512%` |
| `0.9999999` | ` 0.9999999 398ms` | `0.9999999 83ms` `480%` |
| `0.99999999` | ` 0.99999999 367ms` | `0.99999999 77ms` `477%` |
| `0.999999999` | ` 0.999999999 436ms` | `0.999999999 89ms` `490%` |
| `0.9999999999` | ` 0.9999999999 442ms` | `0.9999999999 89ms` `497%` |
| `0.99999999999` | ` 0.99999999999 435ms` | `0.99999999999 95ms` `458%` |
| `0.999999999999` | ` 0.999999999999 465ms` | `0.999999999999 100ms` `465%` |
| `0.9999999999999` | ` 0.9999999999999 447ms` | `0.9999999999999 104ms` `430%` |
| `0.99999999999999` | ` 0.99999999999999 472ms` | `0.99999999999999 115ms` `410%` |
| `0.999999999999999` | ` 0.999999999999999 540ms` | `0.999999999999999 116ms` `466%` |
| `0.9999999999999999` | ` 0.9999999999999999 459ms` | `1.0 120ms` `382%` |

| Input | atod    | ldouble |
| :---- | :------ | :------ |
| `9.9` | ` 9.9 321ms` | `9.9 46ms` `698%` |
| `9.99` | ` 9.99 331ms` | `9.99 51ms` `649%` |
| `9.999` | ` 9.999 435ms` | `9.999 58ms` `750%` |
| `9.9999` | ` 9.9999 374ms` | `9.9999 80ms` `468%` |
| `9.99999` | ` 9.99999 449ms` | `9.99999 81ms` `554%` |
| `9.999999` | ` 9.999999 465ms` | `9.999999 79ms` `589%` |
| `9.9999999` | ` 9.9999999 446ms` | `9.9999999 77ms` `579%` |
| `9.99999999` | ` 9.99999999 447ms` | `9.99999999 83ms` `539%` |
| `9.999999999` | ` 9.999999999 476ms` | `9.999999999 84ms` `567%` |
| `9.9999999999` | ` 9.9999999999 490ms` | `9.9999999999 91ms` `538%` |
| `9.99999999999` | ` 9.99999999999 482ms` | `9.99999999999 97ms` `497%` |
| `9.999999999999` | ` 9.999999999999 525ms` | `9.999999999999 105ms` `500%` |
| `9.9999999999999` | ` 9.9999999999999 532ms` | `9.9999999999999 110ms` `484%` |
| `9.99999999999999` | ` 9.99999999999999 533ms` | `9.99999999999999 114ms` `468%` |
| `9.999999999999999` | ` 9.999999999999998 624ms` | `10.0 124ms` `503%` |
| `9.9999999999999999` | ` 10.0 539ms` | `10.0 124ms` `435%` |

| Input | atod    | ldouble |
| :---- | :------ | :------ |
| `0.1` | ` 0.1 251ms` | `0.1 47ms` `534%` |
| `0.11` | ` 0.11 271ms` | `0.11 58ms` `467%` |
| `0.111` | ` 0.111 358ms` | `0.111 56ms` `639%` |
| `0.1111` | ` 0.1111 322ms` | `0.1111 85ms` `379%` |
| `0.11111` | ` 0.11111 375ms` | `0.11111 78ms` `481%` |
| `0.111111` | ` 0.111111 392ms` | `0.111111 83ms` `472%` |
| `0.1111111` | ` 0.1111111 391ms` | `0.1111111 81ms` `483%` |
| `0.11111111` | ` 0.11111111 366ms` | `0.11111111 85ms` `431%` |
| `0.111111111` | ` 0.111111111 398ms` | `0.111111111 82ms` `485%` |
| `0.1111111111` | ` 0.1111111111 419ms` | `0.1111111111 90ms` `466%` |
| `0.11111111111` | ` 0.11111111111 412ms` | `0.11111111111 91ms` `453%` |
| `0.111111111111` | ` 0.111111111111 440ms` | `0.111111111111 99ms` `444%` |
| `0.1111111111111` | ` 0.1111111111111 441ms` | `0.1111111111111 105ms` `420%` |
| `0.11111111111111` | ` 0.11111111111111 445ms` | `0.11111111111111 111ms` `401%` |
| `0.111111111111111` | ` 0.111111111111111 538ms` | `0.111111111111111 115ms` `468%` |
| `0.1111111111111111` | ` 0.1111111111111111 459ms` | `0.1111111111111111 124ms` `370%` |

| Input | atod    | ldouble |
| :---- | :------ | :------ |
| `1.1` | ` 1.1 334ms` | `1.1 51ms` `655%` |
| `1.11` | ` 1.11 334ms` | `1.11 54ms` `619%` |
| `1.111` | ` 1.111 418ms` | `1.111 60ms` `697%` |
| `1.1111` | ` 1.1111 393ms` | `1.1111 72ms` `546%` |
| `1.11111` | ` 1.11111 425ms` | `1.11111 79ms` `538%` |
| `1.111111` | ` 1.111111 464ms` | `1.111111 84ms` `552%` |
| `1.1111111` | ` 1.1111111 469ms` | `1.1111111 85ms` `552%` |
| `1.11111111` | ` 1.11111111 435ms` | `1.11111111 81ms` `537%` |
| `1.111111111` | ` 1.111111111 490ms` | `1.111111111 87ms` `563%` |
| `1.1111111111` | ` 1.1111111111 501ms` | `1.1111111111 98ms` `511%` |
| `1.11111111111` | ` 1.11111111111 495ms` | `1.11111111111 101ms` `490%` |
| `1.111111111111` | ` 1.111111111111 541ms` | `1.111111111111 105ms` `515%` |
| `1.1111111111111` | ` 1.1111111111111 515ms` | `1.1111111111111 112ms` `460%` |
| `1.11111111111111` | ` 1.11111111111111 534ms` | `1.11111111111111 113ms` `473%` |
| `1.111111111111111` | ` 1.111111111111111 594ms` | `1.111111111111111 121ms` `491%` |
| `1.1111111111111111` | ` 1.111111111111111 531ms` | `1.111111111111111 124ms` `428%` |

| Input | atod    | ldouble |
| :---- | :------ | :------ |
| `1.23456e-300` | ` 1.23456e-300 1071ms` | `1.23456e-300 94ms` `1139%` |
| `1.23456e-301` | ` 1.23456e-301 1044ms` | `1.23456e-301 100ms` `1044%` |
| `1.23456e-302` | ` 1.23456e-302 1047ms` | `1.23456e-302 103ms` `1017%` |
| `1.23456e-303` | ` 1.23456e-303 990ms` | `1.23456e-303 105ms` `943%` |
| `1.23456e-304` | ` 1.23456e-304 1104ms` | `1.23456e-304 96ms` `1150%` |
| `1.23456e-305` | ` 1.23456e-305 1095ms` | `1.23456e-305 98ms` `1117%` |
| `1.23456e-306` | ` 1.23456e-306 1188ms` | `1.23456e-306 105ms` `1131%` |
| `1.23456e-307` | ` 1.23456e-307 1243ms` | `1.23456e-307 111ms` `1120%` |
| `1.23456e-308` | ` 1.23456e-308 1138ms` | `1.23456e-308 106ms` `1074%` |
| `1.23456e-309` | ` 1.23456e-309 958ms` | `1.23456e-309 101ms` `949%` |
| `1.23456e-310` | ` 1.23456e-310 1036ms` | `1.23456e-310 101ms` `1026%` |
| `1.23456e-311` | ` 1.23456e-311 994ms` | `1.23456e-311 97ms` `1025%` |
| `1.23456e-312` | ` 1.23456e-312 1265ms` | `1.23456e-312 108ms` `1171%` |
| `1.23456e-313` | ` 1.23456e-313 1234ms` | `1.23456e-313 95ms` `1299%` |
| `1.23456e-314` | ` 1.23456e-314 1247ms` | `1.23456e-314 103ms` `1211%` |
| `1.23456e-315` | ` 1.23456e-315 1066ms` | `1.23456e-315 101ms` `1055%` |
| `1.23456e-316` | ` 1.23456e-316 1077ms` | `1.23456e-316 97ms` `1110%` |
| `1.23456e-317` | ` 1.23456e-317 1064ms` | `1.23456e-317 101ms` `1053%` |
| `1.23456e-318` | ` 1.23456e-318 1109ms` | `1.23456e-318 100ms` `1109%` |
| `1.23456e-319` | ` 1.23459e-319 1069ms` | `1.23459e-319 101ms` `1058%` |
| `1.23456e-320` | ` 1.2349e-320 1108ms` | `1.2349e-320 103ms` `1076%` |
| `1.23456e-321` | ` 1.237e-321 1123ms` | `1.237e-321 107ms` `1050%` |
| `1.23456e-322` | ` 1.25e-322 1140ms` | `1.25e-322 100ms` `1140%` |
| `1.23456e-323` | ` 1e-323 1081ms` | `1e-323 103ms` `1050%` |

| Input | atod    | ldouble |
| :---- | :------ | :------ |
| `1.23456e+300` | ` 1.23456e+300 695ms` | `1.23456e+300 94ms` `739%` |
| `1.23456e+301` | ` 1.23456e+301 634ms` | `1.23456e+301 96ms` `660%` |
| `1.23456e+302` | ` 1.23456e+302 668ms` | `1.23456e+302 100ms` `668%` |
| `1.23456e+303` | ` 1.23456e+303 657ms` | `1.23456e+303 101ms` `650%` |
| `1.23456e+304` | ` 1.23456e+304 687ms` | `1.23456e+304 99ms` `694%` |
| `1.23456e+305` | ` 1.23456e+305 670ms` | `1.23456e+305 102ms` `657%` |
| `1.23456e+306` | ` 1.23456e+306 689ms` | `1.23456e+306 107ms` `644%` |
| `1.23456e+307` | ` 1.23456e+307 710ms` | `1.23456e+307 101ms` `703%` |
| `1.23456e+308` | ` 1.23456e+308 750ms` | `1.23456e+308 92ms` `815%` |
| `1.23456e+309` | ` inf 191ms` | `inf 105ms` `182%` |
| `1.23456e+310` | ` inf 161ms` | `inf 100ms` `161%` |

## 接口说明

见 `json.h`  `jnum.h` 文件。

## 零堆内存分配模式

对于小JSON文件解析打印时，推荐使用零堆内存分配模式，LJSON库只在第一次处理时分配内存，后续处理LJSON库内部可能不会进行任何堆内存分配。

* 解析存储json对象一直复用内存池mem
* 解析存储字符串值复用原始字符串(即原始字符串会被修改，且使用json过程中不能释放)
* 获取 `JSON_ARRAY` / `JSON_OBJECT` 下的对象可使用 `json_get_items` 加速，可一直复用此对象内存(每个级别都要有单独的 `json_items_t` )
* 打印一直复用 `json_print_ptr_t` 的成员 `p`

```c
size_t len = 0;

// 初始化只做一次(解析)
json_mem_t mem;
pjson_memory_init(&mem);
/* obj_mgr需要设置合适的值以便一个内存块可以存下所有的object, 如果是不复用原始字符串，其它2个mgr也需要设置 */
mem.valid = true;
mem.obj_mgr.mem_size = max_data_size;

// 解析加速复用items
json_items_t items;
memset(&items, 0, sizeof(items));

// 初始化只做一次(打印)
json_print_ptr_t ptr = {PRINT_BUF_LEN, 0};

// 业务循环
while (1) {
    /* ---- 接收消息JSON解析 ---- */
    json_object *json = json_reuse_parse_str(buf, &len, &mem);
        // 获取某JSON_ARRAY下的所有数据
        if (json_get_items(array, &items) < 0)
            return -1;
        for (size_t i = 0; i < items.count; ++i) {
            ids.push_back(json_get_lint_value(items.items[i].json));
        }

    /* ----- 业务处理逻辑 ---- */

    /* ---- 发送消息JSON打印 ----*/
    json_sax_print_hd hd = json_sax_print_unformat_start(100, &ptr); // 开始打印(复用ptr)
    json_sax_print_object(hd, NULL, JSON_SAX_START); // 顶层左花括号
        // 打印某JSON_OBJECT下的数据
        json_sax_print_string(hd, &key, sval);
        // 打印某JSON_ARRAY下的所有数据
        json_sax_print_array(hd, &key, JSON_SAX_START);
        for (const auto &v : ids) {
            json_sax_print_lint(hd, NULL, v);
        }
        json_sax_print_array(hd, NULL, JSON_SAX_FINISH);
    ret |= json_sax_print_object(hd, NULL, JSON_SAX_FINISH); // 顶层右花括号
    json_sax_print_finish(hd, len, &ptr) // 结束打印，生成的字符串位于ptr.p或返回值

    /* ----- JSON内存池处理 ---- */
    // 不再需要json结构，只保留第一个链表节点
    pjson_memory_refresh(&mem);
}

// 销毁资源只做一次(解析)
json_free_items(&items);
pjson_memory_free(&mem);

// 销毁资源只做一次(打印)
json_memory_free(ptr.p);
```

## 参考代码

* 参考了[cJSON](https://github.com/DaveGamble/cJSON)的实现，其中utf16_literal_to_utf8函数完全来自cJSON

## 联系方式

* Phone: +86 18368887550
* wx/qq: 1083936981
* Email: lengjingzju@163.com 3090101217@zju.edu.cn
